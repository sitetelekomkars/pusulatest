const BAKIM_MODU=!1,_0x4e21=["aHR0cHM6Ly9zY3JpcHQuZ29vZ2xlLmNvbS9tYWNyb3Mvcy9BS2Z5Y2J5M2tkMDRrMnU5WGRWRGQxLXZkYlFRQXNITlc2V0xJbjhiTll4VGxWQ0wzVTFhMFdxWm82b1BwOXpmQldJcHdKRWluUS9leGVj"];const SCRIPT_URL=atob(_0x4e21[0]);let jokers={call:1,half:1,double:1},doubleChanceUsed=!1,firstAnswerIndex=-1;const VALID_CATEGORIES=["Teknik","ƒ∞kna","Kampanya","Bilgi"];let database=[],newsData=[],sportsData=[],salesScripts=[],quizQuestions=[],currentUser="",isAdminMode=!1,isEditingActive=!1,sessionTimeout,activeCards=[],currentCategory="all",adminUserList=[],allEvaluationsData=[],wizardStepsData={};const MONTH_NAMES=["Ocak","≈ûubat","Mart","Nisan","Mayƒ±s","Haziran","Temmuz","Aƒüustos","Eyl√ºl","Ekim","Kasƒ±m","Aralƒ±k"];window.updateRowScore=function(e,t){const a=document.getElementById(`slider-${e}`),n=document.getElementById(`badge-${e}`),l=document.getElementById(`note-${e}`),o=document.getElementById(`row-${e}`);if(!a)return;const i=parseInt(a.value);n.innerText=i,i<t?(l.style.display="block",n.style.background="#d32f2f",o.style.borderColor="#ffcdd2",o.style.background="#fff5f5"):(l.style.display="none",l.value="",n.style.background="#2e7d32",o.style.borderColor="#eee",o.style.background="#fff"),window.recalcTotalScore()},window.recalcTotalScore=function(){let e=0,t=0;document.querySelectorAll(".slider-input").forEach(a=>{e+=parseInt(a.value)||0,t+=parseInt(a.getAttribute("max"))||0});const a=document.getElementById("live-score"),n=document.getElementById("score-ring");if(a&&(a.innerText=e),n){let l="#2e7d32",o=t>0?e/t*100:0;o<50?l="#d32f2f":o<85?l="#ed6c02":o<95&&(l="#fabb00"),n.style.background=`conic-gradient(${l} ${o}%, #444 ${o}%)`}};function getToken(){return localStorage.getItem("sSportToken")}function getFavs(){return JSON.parse(localStorage.getItem("sSportFavs")||"[]")}function toggleFavorite(e){event.stopPropagation();let t=getFavs();t.includes(e)?t=t.filter(t=>t!==e):t.push(e),localStorage.setItem("sSportFavs",JSON.stringify(t)),"fav"===currentCategory?filterCategory(document.querySelector(".btn-fav"),"fav"):renderCards(activeCards)}function isFav(e){return getFavs().includes(e)}function formatDateToDDMMYYYY(e){if(!e)return"N/A";if(e.match(/^\d{2}\.\d{2}\.\d{4}/))return e;try{const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0");return`${a}.${n}.${t.getFullYear()}`}catch(t){return e}}function isNew(e){if(!e)return!1;let t;if(e.indexOf(".")>-1){const a=e.split(" ")[0].split(".");t=new Date(a[2],a[1]-1,a[0])}else t=new Date(e);if(isNaN(t.getTime()))return!1;return Math.ceil(Math.abs(new Date-t)/864e5)<=3}function getCategorySelectHtml(e,t){let a=VALID_CATEGORIES.map(t=>`<option value="${t}" ${t===e?"selected":""}>${t}</option>`).join("");return e&&!VALID_CATEGORIES.includes(e)&&(a=`<option value="${e}" selected>${e} (Hata)</option>`+a),`<select id="${t}" class="swal2-input" style="width:100%; margin-top:5px;">${a}</select>`}function escapeForJsString(e){return e?e.toString().replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,""):""}document.addEventListener("contextmenu",e=>e.preventDefault()),document.onkeydown=function(e){if(123==e.keyCode)return!1},document.addEventListener("DOMContentLoaded",()=>{checkSession()});function checkSession(){const e=localStorage.getItem("sSportUser"),t=localStorage.getItem("sSportToken"),a=localStorage.getItem("sSportRole");e&&t&&(currentUser=e,document.getElementById("login-screen").style.display="none",document.getElementById("user-display").innerText=currentUser,checkAdmin(a),startSessionTimer(),BAKIM_MODU?document.getElementById("maintenance-screen").style.display="flex":(document.getElementById("main-app").style.display="block",loadContentData(),loadWizardData()))}function enterBas(e){"Enter"===e.key&&girisYap()}function girisYap(){const e=document.getElementById("usernameInput").value.trim(),t=document.getElementById("passInput").value.trim(),a=document.getElementById("loading-msg"),n=document.getElementById("error-msg");if(!e||!t)return n.innerText="L√ºtfen bilgileri giriniz.",void(n.style.display="block");a.style.display="block",a.innerText="Doƒürulanƒ±yor...",n.style.display="none",document.querySelector(".login-btn").disabled=!0;const l=CryptoJS.SHA256(t).toString();fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"login",username:e,password:l})}).then(e=>e.json()).then(e=>{a.style.display="none",document.querySelector(".login-btn").disabled=!1,"success"===e.result?(currentUser=e.username,localStorage.setItem("sSportUser",currentUser),localStorage.setItem("sSportToken",e.token),localStorage.setItem("sSportRole",e.role),!0===e.forceChange?Swal.fire({icon:"warning",title:" ‚ö†Ô∏è  G√ºvenlik Uyarƒ±sƒ±",text:"ƒ∞lk giri≈üiniz. L√ºtfen ≈üifrenizi deƒüi≈ütirin.",allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"≈ûifremi Deƒüi≈ütir"}).then(()=>{changePasswordPopup(!0)}):(document.getElementById("login-screen").style.display="none",document.getElementById("user-display").innerText=currentUser,checkAdmin(e.role),startSessionTimer(),BAKIM_MODU?document.getElementById("maintenance-screen").style.display="flex":(document.getElementById("main-app").style.display="block",loadContentData(),loadWizardData()))):(n.innerText=e.message||"Hatalƒ± giri≈ü!",n.style.display="block")}).catch(e=>{console.error("Login Error:",e),a.style.display="none",document.querySelector(".login-btn").disabled=!1,n.innerText="Sunucu hatasƒ±! L√ºtfen sayfayƒ± yenileyin.",n.style.display="block"})}function checkAdmin(e){const t=document.getElementById("dropdownAddCard"),a=document.getElementById("dropdownQuickEdit");isAdminMode="admin"===e,isEditingActive=!1,document.body.classList.remove("editing"),isAdminMode?(t&&(t.style.display="flex"),a&&(a.style.display="flex",a.innerHTML='<i class="fas fa-pen" style="color:var(--secondary);"></i> D√ºzenlemeyi A√ß',a.classList.remove("active"))):(t&&(t.style.display="none"),a&&(a.style.display="none"))}function logout(){currentUser="",isAdminMode=!1,isEditingActive=!1,document.body.classList.remove("editing"),localStorage.removeItem("sSportUser"),localStorage.removeItem("sSportToken"),localStorage.removeItem("sSportRole"),sessionTimeout&&clearTimeout(sessionTimeout),document.getElementById("main-app").style.display="none",document.getElementById("login-screen").style.display="flex",document.getElementById("passInput").value="",document.getElementById("usernameInput").value="",document.getElementById("error-msg").style.display="none"}function startSessionTimer(){sessionTimeout&&clearTimeout(sessionTimeout),sessionTimeout=setTimeout(()=>{Swal.fire({icon:"warning",title:"Oturum S√ºresi Doldu",text:"G√ºvenlik nedeniyle otomatik √ßƒ±kƒ±≈ü yapƒ±ldƒ±.",confirmButtonText:"Tamam"}).then(()=>{logout()})},36e5)}function openUserMenu(){Swal.fire({title:`Merhaba, ${currentUser}`,showCancelButton:!0,showDenyButton:!0,confirmButtonText:" üîë  ≈ûifre Deƒüi≈ütir",denyButtonText:" üö™  √áƒ±kƒ±≈ü Yap",cancelButtonText:"ƒ∞ptal"}).then(e=>{e.isConfirmed?changePasswordPopup():e.isDenied&&logout()})}async function changePasswordPopup(e=!1){const{value:t}=await Swal.fire({title:e?"Yeni ≈ûifre Belirleyin":"≈ûifre Deƒüi≈ütir",html:`${e?'<p style="font-size:0.9rem; color:#d32f2f;">ƒ∞lk giri≈ü ≈üifrenizi deƒüi≈ütirmeden devam edemezsiniz.</p>':""}<input id="swal-old-pass" type="password" class="swal2-input" placeholder="Eski ≈ûifre (Mevcut)"><input id="swal-new-pass" type="password" class="swal2-input" placeholder="Yeni ≈ûifre">`,focusConfirm:!1,showCancelButton:!e,allowOutsideClick:!e,allowEscapeKey:!e,confirmButtonText:"Deƒüi≈ütir",cancelButtonText:"ƒ∞ptal",preConfirm:()=>{const e=document.getElementById("swal-old-pass").value,t=document.getElementById("swal-new-pass").value;return e&&t?[e,t]:void Swal.showValidationMessage("Alanlar bo≈ü bƒ±rakƒ±lamaz")}});t?((!Swal.isVisible()||!Swal.isLoading())&&Swal.fire({title:"ƒ∞≈üleniyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"changePassword",username:currentUser,oldPass:CryptoJS.SHA256(t[0]).toString(),newPass:CryptoJS.SHA256(t[1]).toString(),token:getToken()})}).then(e=>e.json()).then(t=>{"success"===t.result?Swal.fire("Ba≈üarƒ±lƒ±!","≈ûifreniz g√ºncellendi. G√ºvenlik gereƒüi yeniden giri≈ü yapƒ±nƒ±z.","success").then(()=>{logout()}):Swal.fire("Hata",t.message||"ƒ∞≈ülem ba≈üarƒ±sƒ±z.","error").then(()=>{e&&changePasswordPopup(!0)})}).catch(t=>{Swal.fire("Hata","Sunucu hatasƒ±.","error"),e&&changePasswordPopup(!0)})):e&&changePasswordPopup(!0)}function loadContentData(){document.getElementById("loading").style.display="block",fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchData"})}).then(e=>e.json()).then(e=>{if(document.getElementById("loading").style.display="none","success"===e.result){const t=e.data;database=t.filter(e=>["card","bilgi","teknik","kampanya","ikna"].includes(e.Type.toLowerCase())).map(e=>({title:e.Title,category:e.Category,text:e.Text,script:e.Script,code:e.Code,link:e.Link,date:formatDateToDDMMYYYY(e.Date)})),newsData=t.filter(e=>"news"===e.Type.toLowerCase()).map(e=>({date:formatDateToDDMMYYYY(e.Date),title:e.Title,desc:e.Text,type:e.Category,status:e.Status})),sportsData=t.filter(e=>"sport"===e.Type.toLowerCase()).map(e=>({title:e.Title,icon:e.Icon,desc:e.Text,tip:e.Tip,detail:e.Detail,pronunciation:e.Pronunciation})),salesScripts=t.filter(e=>"sales"===e.Type.toLowerCase()).map(e=>({title:e.Title,text:e.Text})),quizQuestions=t.filter(e=>"quiz"===e.Type.toLowerCase()).map(e=>({q:e.Text,opts:e.QuizOptions?e.QuizOptions.split(",").map(e=>e.trim()):[],a:parseInt(e.QuizAnswer)})),"fav"===currentCategory?filterCategory(document.querySelector(".btn-fav"),"fav"):(activeCards=database,renderCards(database)),startTicker()}else document.getElementById("loading").innerHTML=`Veriler alƒ±namadƒ±: ${e.message||"Bilinmeyen Hata"}`}).catch(e=>{console.error("Fetch Hatasƒ±:",e),document.getElementById("loading").innerHTML="Baƒülantƒ± Hatasƒ±! Sunucuya ula≈üƒ±lamƒ±yor."})}function loadWizardData(){return new Promise((e,t)=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getWizardData"})}).then(e=>e.json()).then(a=>{"success"===a.result&&a.steps?(wizardStepsData=a.steps,e()):(wizardStepsData={},t(new Error("Wizard verisi y√ºklenemedi."))) ‡§ó‡•á‡§≤‡•ç‡§Ø‡§æ.catch(e=>{wizardStepsData={},t(e)})})}function renderCards(e){activeCards=e;const t=document.getElementById("cardGrid");if(t.innerHTML="",0===e.length)return void(t.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:20px; color:#777;">Kayƒ±t bulunamadƒ±.</div>');e.forEach((e,a)=>{const n=escapeForJsString(e.title),l=isFav(e.title)?"fas fa-star active":"far fa-star",o=isNew(e.date)?'<span class="new-badge">YENƒ∞</span>':"",i=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" onclick="editContent(${a})" style="display:block;"></i>`:"",r=(e.text||"").replace(/\n/g,"<br>").replace(/\*(.*?)\*/g,"<b>$1</b>");let s=`<div class="card ${e.category}">${o}\n            <div class="icon-wrapper">\n                ${i}\n                <i class="${l} fav-icon" onclick="toggleFavorite('${n}')"></i>\n            </div>\n            <div class="card-header"><h3 class="card-title">${highlightText(e.title)}</h3><span class="badge">${e.category}</span></div>\n            <div class="card-content" onclick="showCardDetail('${n}', '${escapeForJsString(e.text)}')">\n                <div class="card-text-truncate">${highlightText(r)}</div>\n                <div style="font-size:0.8rem; color:#999; margin-top:5px; text-align:right;">(Tamamƒ±nƒ± oku)</div>\n            </div>\n            <div class="script-box">${highlightText(e.script)}</div>\n            <div class="card-actions">\n                <button class="btn btn-copy" onclick="copyText('${escapeForJsString(e.script)}')"><i class="fas fa-copy"></i> Kopyala</button>\n                ${e.code?`<button class="btn btn-copy" style="background:var(--secondary); color:#333;" onclick="copyText('${escapeForJsString(e.code)}')">Kod</button>`:""}\n                ${e.link?`<a href="${e.link}" target="_blank" class="btn btn-link"><i class="fas fa-external-link-alt"></i> Link</a>`:""}\n            </div>\n        </div>`;t.innerHTML+=s})}function highlightText(e){if(!e)return"";const t=document.getElementById("searchInput").value.trim();if(!t)return e;try{return e.toString().replace(new RegExp(`(${t})`,"gi"),'<span class="highlight">$1</span>')}catch(t){return e}}function filterCategory(e,t){currentCategory=t,document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),filterContent()}function filterContent(){const e=document.getElementById("searchInput").value.toLocaleLowerCase("tr-TR").trim();let t=database;"fav"===currentCategory?t=t.filter(e=>isFav(e.title)):"all"!==currentCategory&&(t=t.filter(e=>e.category===currentCategory)),e&&(t=t.filter(t=>{const a=(t.title||"").toString().toLocaleLowerCase("tr-TR"),n=(t.text||"").toString().toLocaleLowerCase("tr-TR"),l=(t.script||"").toString().toLocaleLowerCase("tr-TR"),o=(t.code||"").toString().toLocaleLowerCase("tr-TR");return a.includes(e)||n.includes(e)||l.includes(e)||o.includes(e)})),activeCards=t,renderCards(t)}function showCardDetail(e,t){Swal.fire({title:e,html:`<div style="text-align:left; font-size:1rem; line-height:1.6;">${t.replace(/\\n/g,"<br>")}</div>`,showCloseButton:!0,showConfirmButton:!1,width:"600px",background:"#f8f9fa"})}function copyText(e){navigator.clipboard.writeText(e.replace(/\\n/g,"\n")).then(()=>Swal.fire({icon:"success",title:"Kopyalandƒ±",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}))}function toggleEditMode(){if(!isAdminMode)return;isEditingActive=!isEditingActive,document.body.classList.toggle("editing",isEditingActive);const e=document.getElementById("dropdownQuickEdit");isEditingActive?(e.classList.add("active"),e.innerHTML='<i class="fas fa-times" style="color:var(--accent);"></i> D√ºzenlemeyi Kapat',Swal.fire({icon:"success",title:"D√ºzenleme Modu A√áIK",text:"Kalem ikonlarƒ±na tƒ±klayarak i√ßerikleri d√ºzenleyebilirsiniz.",timer:1500,showConfirmButton:!1})):(e.classList.remove("active"),e.innerHTML='<i class="fas fa-pen" style="color:var(--secondary);"></i> D√ºzenlemeyi A√ß'),filterContent(),"flex"===document.getElementById("guide-modal").style.display&&openGuide(),"flex"===document.getElementById("sales-modal").style.display&&openSales(),"flex"===document.getElementById("news-modal").style.display&&openNews()}function sendUpdate(e,t,a,n="card"){Swal.isVisible()||Swal.fire({title:"Kaydediliyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"updateContent",title:e,column:t,value:a,type:n,originalText:e,username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Ba≈üarƒ±lƒ±",timer:1500,showConfirmButton:!1}),setTimeout(loadContentData,1600)):Swal.fire("Hata","Kaydedilemedi: "+(e.message||"Bilinmeyen Hata"),"error")}).catch(e=>Swal.fire("Hata","Sunucu hatasƒ±.","error"))}async function addNewCardPopup(){const e=getCategorySelectHtml("Bilgi","swal-new-cat"),{value:t}=await Swal.fire({title:"Yeni ƒ∞√ßerik Ekle",html:`\n        <div style="margin-bottom:15px; text-align:left;">\n            <label style="font-weight:bold; font-size:0.9rem;">Ne Ekleyeceksin?</label>\n            <select id="swal-type-select" class="swal2-input" style="width:100%; margin-top:5px; height:35px; font-size:0.9rem;" onchange="toggleAddFields()">\n                <option value="card"> üìå  Bilgi Kartƒ±</option>\n                <option value="news"> üì¢  Duyuru</option>\n                <option value="sales"> üìû  Telesatƒ±≈ü Scripti</option>\n                <option value="sport"> üèÜ  Spor ƒ∞√ßeriƒüi</option>\n                <option value="quiz"> ‚ùì  Quiz Sorusu</option>\n            </select>\n        </div>\n        <div id="preview-card" class="card Bilgi" style="text-align:left; box-shadow:none; border:1px solid #e0e0e0; margin-top:10px;">\n            <div class="card-header" style="align-items: center; gap: 10px;">\n                <input id="swal-new-title" class="swal2-input" style="margin:0; height:40px; flex-grow:1; border:none; border-bottom:2px solid #eee; padding:0 5px; font-weight:bold; color:#0e1b42;" placeholder="Ba≈ülƒ±k Giriniz...">\n                <div id="cat-container" style="width: 110px;">${e}</div>\n            </div>\n            <div class="card-content" style="margin-bottom:10px;">\n                <textarea id="swal-new-text" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; resize:none; font-family:inherit; min-height:100px; padding:10px; background:#f9f9f9;" placeholder="ƒ∞√ßerik metni..."></textarea>\n            </div>\n            <div id="script-container" class="script-box" style="padding:0; border:1px solid #f0e68c;">\n                <textarea id="swal-new-script" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; background:transparent; font-style:italic; min-height:80px; font-size:0.9rem;" placeholder="Script metni (ƒ∞steƒüe baƒülƒ±)..."></textarea>\n            </div>\n            <div id="extra-container" class="card-actions" style="margin-top:15px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">\n                <div style="position:relative;"><i class="fas fa-code" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-new-code" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" placeholder="Kod"></div>\n                <div style="position:relative;"><i class="fas fa-link" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-new-link" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" placeholder="Link"></div>\n            </div>\n            <div id="sport-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Kƒ±sa A√ßƒ±klama (Desc)</label><input id="swal-sport-tip" class="swal2-input" placeholder="Kƒ±sa ƒ∞pucu/Tip">\n                <label style="font-weight:bold;">Detaylƒ± Metin (Detail)</label><input id="swal-sport-detail" class="swal2-input" placeholder="Detaylƒ± A√ßƒ±klama (Alt Metin)">\n                <label style="font-weight:bold;">Okunu≈üu (Pronunciation)</label><input id="swal-sport-pron" class="swal2-input" placeholder="Okunu≈üu">\n                <label style="font-weight:bold;">ƒ∞kon Sƒ±nƒ±fƒ± (Icon)</label><input id="swal-sport-icon" class="swal2-input" placeholder="FontAwesome ƒ∞kon Sƒ±nƒ±fƒ± (e.g., fa-futbol)">\n            </div>\n            <div id="news-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Duyuru Tipi</label><select id="swal-news-type" class="swal2-input"><option value="info">Bilgi</option><option value="update">Deƒüi≈üiklik</option><option value="fix">√á√∂z√ºld√º</option></select>\n                <label style="font-weight:bold;">Durum</label><select id="swal-news-status" class="swal2-input"><option value="Aktif">Aktif</option><option value="Pasif">Pasif (Gizle)</option></select>\n            </div>\n            <div id="quiz-extra" style="display:none; padding:10px;">\n                <label style="font-weight:bold;">Soru Metni (Text)</label><textarea id="swal-quiz-q" class="swal2-textarea" placeholder="Quiz sorusu..."></textarea>\n                <label style="font-weight:bold;">Se√ßenekler (Virg√ºlle Ayƒ±rƒ±n)</label><input id="swal-quiz-opts" class="swal2-input" placeholder="√ñrn: ≈üƒ±k A,≈üƒ±k B,≈üƒ±k C,≈üƒ±k D">\n                <label style="font-weight:bold;">Doƒüru Cevap ƒ∞ndeksi</label><input id="swal-quiz-ans" type="number" class="swal2-input" placeholder="0 (A), 1 (B), 2 (C) veya 3 (D)" min="0" max="3">\n            </div>\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:'<i class="fas fa-plus"></i> Ekle',cancelButtonText:"ƒ∞ptal",focusConfirm:!1,didOpen:()=>{const e=document.getElementById("swal-new-cat"),t=document.getElementById("preview-card");e.style.margin="0",e.style.height="30px",e.style.fontSize="0.8rem",e.style.padding="0 5px",e.addEventListener("change",function(){t.className="card "+this.value}),window.toggleAddFields=function(){const e=document.getElementById("swal-type-select").value,a=document.getElementById("cat-container"),n=document.getElementById("script-container"),l=document.getElementById("extra-container"),o=document.getElementById("sport-extra"),i=document.getElementById("news-extra"),r=document.getElementById("quiz-extra"),s=document.getElementById("preview-card");a.style.display="none",n.style.display="none",l.style.display="none",o.style.display="none",i.style.display="none",r.style.display="none",document.getElementById("swal-new-title").value="",document.getElementById("swal-new-text").value="",s.style.borderLeft="5px solid var(--info)",s.className="card Bilgi","card"===e?(a.style.display="block",n.style.display="block",l.style.display="grid",s.className="card "+document.getElementById("swal-new-cat").value,document.getElementById("swal-new-title").placeholder="Ba≈ülƒ±k Giriniz...",document.getElementById("swal-new-text").placeholder="ƒ∞√ßerik metni..."):"sales"===e?(n.style.display="block",document.getElementById("swal-new-script").placeholder="Satƒ±≈ü Metni...",s.style.borderLeft="5px solid var(--sales)",document.getElementById("swal-new-title").placeholder="Script Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Sadece buraya metin girilecek."):"sport"===e?(o.style.display="block",s.style.borderLeft="5px solid var(--primary)",document.getElementById("swal-new-title").placeholder="Spor Terimi Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Kƒ±sa A√ßƒ±klama (Desc)..."):"news"===e?(i.style.display="block",s.style.borderLeft="5px solid var(--secondary)",document.getElementById("swal-new-title").placeholder="Duyuru Ba≈ülƒ±ƒüƒ±...",document.getElementById("swal-new-text").placeholder="Duyuru Metni (Desc)..."):"quiz"===e&&(r.style.display="block",document.getElementById("swal-new-title").placeholder="Quiz Ba≈ülƒ±ƒüƒ± (√ñrn: Soru 1)",document.getElementById("swal-new-text").placeholder="Bu alan bo≈ü bƒ±rakƒ±lacak.",s.style.borderLeft="5px solid var(--quiz)")}},preConfirm:()=>{const e=document.getElementById("swal-type-select").value,t=new Date,a=t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear(),n="quiz"===e?document.getElementById("swal-quiz-opts").value:"",l="quiz"===e?document.getElementById("swal-quiz-ans").value:"",o="quiz"===e?document.getElementById("swal-quiz-q").value:"";return"quiz"!==e||o&&n&&""!==l?{cardType:e,category:"card"===e?document.getElementById("swal-new-cat").value:"news"===e?document.getElementById("swal-news-type").value:"",title:document.getElementById("swal-new-title").value,text:"quiz"===e?o:document.getElementById("swal-new-text").value,script:"card"===e||"sales"===e?document.getElementById("swal-new-script").value:"",code:"card"===e?document.getElementById("swal-new-code").value:"",status:"news"===e?document.getElementById("swal-news-status").value:"",link:"card"===e?document.getElementById("swal-new-link").value:"",tip:"sport"===e?document.getElementById("swal-sport-tip").value:"",detail:"sport"===e?document.getElementById("swal-sport-detail").value:"",pronunciation:"sport"===e?document.getElementById("swal-sport-pron").value:"",icon:"sport"===e?document.getElementById("swal-sport-icon").value:"",date:a,quizOptions:n,quizAnswer:l}:(Swal.showValidationMessage("Quiz sorusu i√ßin t√ºm alanlar (Soru, Se√ßenekler, Cevap ƒ∞ndeksi) zorunludur."),!1)}});t&&(!t.title?Swal.fire("Hata","Ba≈ülƒ±k zorunlu!","error"):(Swal.fire({title:"Ekleniyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addCard",username:currentUser,token:getToken(),...t})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Ba≈üarƒ±lƒ±",text:"ƒ∞√ßerik eklendi.",timer:2e3,showConfirmButton:!1}),setTimeout(loadContentData,3500)):Swal.fire("Hata",e.message||"Eklenemedi.","error")}).catch(e=>Swal.fire("Hata","Sunucu hatasƒ±: "+e,"error"))))}async function editContent(e){const t=activeCards[e],a=getCategorySelectHtml(t.category,"swal-cat"),{value:n}=await Swal.fire({title:"Kartƒ± D√ºzenle",html:`\n        <div id="preview-card-edit" class="card ${t.category}" style="text-align:left; box-shadow:none; border:1px solid #e0e0e0; margin-top:10px;">\n            <div class="card-header" style="align-items: center; gap: 10px;">\n                <input id="swal-title" class="swal2-input" style="margin:0; height:40px; flex-grow:1; border:none; border-bottom:2px solid #eee; padding:0 5px; font-weight:bold; color:#0e1b42;" value="${t.title}" placeholder="Ba≈ülƒ±k">\n                <div style="width: 110px;">${a}</div>\n            </div>\n            <div class="card-content" style="margin-bottom:10px;">\n                <textarea id="swal-text" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; resize:none; font-family:inherit; min-height:120px; padding:10px; background:#f9f9f9;" placeholder="ƒ∞√ßerik metni...">${(t.text||"").toString().replace(/<br>/g,"\n")}</textarea>\n            </div>\n            <div class="script-box" style="padding:0; border:1px solid #f0e68c;">\n                <textarea id="swal-script" class="swal2-textarea" style="margin:0; width:100%; box-sizing:border-box; border:none; background:transparent; font-style:italic; min-height:80px; font-size:0.9rem;" placeholder="Script metni...">${(t.script||"").toString().replace(/<br>/g,"\n")}</textarea>\n            </div>\n            <div class="card-actions" style="margin-top:15px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">\n                <div style="position:relative;"><i class="fas fa-code" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-code" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" value="${t.code||""}" placeholder="Kod"></div>\n                <div style="position:relative;"><i class="fas fa-link" style="position:absolute; left:10px; top:10px; color:#aaa;"></i><input id="swal-link" class="swal2-input" style="margin:0; height:35px; font-size:0.85rem; padding-left:30px;" value="${t.link||""}" placeholder="Link"></div>\n            </div>\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:'<i class="fas fa-save"></i> Deƒüi≈üiklikleri Kaydet',cancelButtonText:"ƒ∞ptal",focusConfirm:!1,preConfirm:()=>({cat:document.getElementById("swal-cat").value,title:document.getElementById("swal-title").value,text:document.getElementById("swal-text").value,script:document.getElementById("swal-script").value,code:document.getElementById("swal-code").value,link:document.getElementById("swal-link").value})});n&&(n.cat!==t.category&&sendUpdate(t.title,"Category",n.cat,"card"),n.text!==(t.text||"").replace(/<br>/g,"\n")&&setTimeout(()=>sendUpdate(t.title,"Text",n.text,"card"),500),n.script!==(t.script||"").replace(/<br>/g,"\n")&&setTimeout(()=>sendUpdate(t.title,"Script",n.script,"card"),1e3),n.code!==(t.code||"")&&setTimeout(()=>sendUpdate(t.title,"Code",n.code,"card"),1500),n.link!==(t.link||"")&&setTimeout(()=>sendUpdate(t.title,"Link",n.link,"card"),2e3),n.title!==t.title&&setTimeout(()=>sendUpdate(t.title,"Title",n.title,"card"),2500))}async function editSport(e){event.stopPropagation();const t=sportsData.find(t=>t.title===e);if(!t)return Swal.fire("Hata","ƒ∞√ßerik bulunamadƒ±.","error");const{value:a}=await Swal.fire({title:"Spor ƒ∞√ßeriƒüini D√ºzenle",html:`\n        <div class="card" style="text-align:left; border-left: 5px solid var(--primary); padding:15px; background:#f8f9fa;">\n            <label style="font-weight:bold;">Ba≈ülƒ±k</label>\n            <input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.title}">\n            <label style="font-weight:bold;">A√ßƒ±klama (Kƒ±sa Metin)</label>\n            <textarea id="swal-desc" class="swal2-textarea" style="margin-bottom:10px;">${t.desc||""}</textarea>\n            <label style="font-weight:bold;">ƒ∞pucu (Tip)</label>\n            <input id="swal-tip" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.tip||""}">\n            <label style="font-weight:bold;">Detay (Alt Metin)</label>\n            <textarea id="swal-detail" class="swal2-textarea" style="margin-bottom:10px;">${t.detail||""}</textarea>\n            <label style="font-weight:bold;">Okunu≈ü</label>\n            <input id="swal-pron" class="swal2-input" style="width:100%; margin-bottom:10px;" value="${t.pronunciation||""}">\n            <label style="font-weight:bold;">ƒ∞kon Sƒ±nƒ±fƒ±</label>\n            <input id="swal-icon" class="swal2-input" style="width:100%;" value="${t.icon||""}">\n        </div>`,width:"700px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-desc").value,document.getElementById("swal-tip").value,document.getElementById("swal-detail").value,document.getElementById("swal-pron").value,document.getElementById("swal-icon").value]});if(a){const e=t.title;a[1]!==t.desc&&sendUpdate(e,"Text",a[1],"sport"),a[2]!==t.tip&&setTimeout(()=>sendUpdate(e,"Tip",a[2],"sport"),500),a[3]!==t.detail&&setTimeout(()=>sendUpdate(e,"Detail",a[3],"sport"),1e3),a[4]!==t.pronunciation&&setTimeout(()=>sendUpdate(e,"Pronunciation",a[4],"sport"),1500),a[5]!==t.icon&&setTimeout(()=>sendUpdate(e,"Icon",a[5],"sport"),2e3),a[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",a[0],"sport"),2500)}}async function editSales(e){event.stopPropagation();const t=salesScripts.find(t=>t.title===e);if(!t)return Swal.fire("Hata","ƒ∞√ßerik bulunamadƒ±.","error");const{value:a}=await Swal.fire({title:"Satƒ±≈ü Metnini D√ºzenle",html:`<div class="card" style="text-align:left; border-left: 5px solid var(--sales); padding:15px; background:#ecfdf5;"><label style="font-weight:bold;">Ba≈ülƒ±k</label><input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;"\n        value="${t.title}"><label style="font-weight:bold;">Metin</label><textarea id="swal-text" class="swal2-textarea" style="min-height:150px;">${t.text||""}</textarea></div>`,width:"700px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-text").value]});if(a){const e=t.title;a[1]!==t.text&&sendUpdate(e,"Text",a[1],"sales"),a[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",a[0],"sales"),500)}}async function editNews(e){const t=newsData[e];let a=`<option value="Aktif" ${"Pasif"!==t.status?"selected":""}>Aktif</option><option value="Pasif" ${"Pasif"===t.status?"selected":""}>Pasif (Gizle)</option>`,n=`<option value="info" ${"info"===t.type?"selected":""}>Bilgi</option><option value="update" ${"update"===t.type?"selected":""}>Deƒüi≈üiklik</option><option value="fix" ${"fix"===t.type?"selected":""}>√á√∂z√ºld√º</option>`;const{value:l}=await Swal.fire({title:"Duyuruyu D√ºzenle",html:`<div class="card" style="text-align:left; border-left: 5px solid var(--secondary); padding:15px; background:#fff8e1;"><label style="font-weight:bold;">Ba≈ülƒ±k</label><input id="swal-title" class="swal2-input" style="width:100%; margin-bottom:10px;"\n        value="${t.title||""}"><div style="display:flex; gap:10px; margin-bottom:10px;"><div style="flex:1;"><label style="font-weight:bold;">Tarih</label><input id="swal-date" class="swal2-input" style="width:100%;"\n        value="${t.date||""}"></div><div style="flex:1;"><label style="font-weight:bold;">T√ºr</label><select id="swal-type" class="swal2-input" style="width:100%;">${n}</select></div></div><label style="font-weight:bold;">Metin</label><textarea id="swal-desc" class="swal2-textarea" style="margin-bottom:10px;">${t.desc||""}</textarea><label style="font-weight:bold;">Durum</label><select id="swal-status" class="swal2-input" style="width:100%;">${a}</select></div>`,width:"600px",showCancelButton:!0,confirmButtonText:"Kaydet",preConfirm:()=>[document.getElementById("swal-title").value,document.getElementById("swal-date").value,document.getElementById("swal-desc").value,document.getElementById("swal-type").value,document.getElementById("swal-status").value]});if(l){const e=t.title;l[1]!==t.date&&sendUpdate(e,"Date",l[1],"news"),l[2]!==t.desc&&setTimeout(()=>sendUpdate(e,"Text",l[2],"news"),500),l[3]!==t.type&&setTimeout(()=>sendUpdate(e,"Category",l[3],"news"),1e3),l[4]!==t.status&&setTimeout(()=>sendUpdate(e,"Status",l[4],"news"),1500),l[0]!==e&&setTimeout(()=>sendUpdate(e,"Title",l[0],"news"),2e3)}}function closeModal(e){document.getElementById(e).style.display="none"}let tickerIndex=0;function startTicker(){const e=document.getElementById("ticker-content"),t=newsData.filter(e=>"Pasif"!==e.status);if(0===t.length)return e.innerHTML="G√ºncel duyuru yok.",void(e.style.animation="none");let a=t.map(e=>`<span style="color:#fabb00; font-weight:bold;">[${e.date}]</span> <span style="color:#fff;">${e.title}:</span> <span style="color:#ddd;">${e.desc}</span>`).join(" &nbsp;&nbsp;&nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp;&nbsp;&nbsp; ");e.innerHTML=a+" &nbsp;&nbsp;&nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp;&nbsp;&nbsp; "+a+" &nbsp;&nbsp;&nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp;&nbsp;&nbsp; "+a,e.style.animation="ticker-scroll 90s linear infinite"}function openNews(){document.getElementById("news-modal").style.display="flex";const e=document.getElementById("news-container");e.innerHTML="",newsData.forEach((t,a)=>{let n="fix"===t.type?"tag-fix":"update"===t.type?"tag-update":"tag-info",l="fix"===t.type?"√á√∂z√ºld√º":"update"===t.type?"Deƒüi≈üiklik":"Bilgi",o="Pasif"===t.status?"opacity:0.5; background:#eee;":"",i="Pasif"===t.status?'<span class="news-tag" style="background:#555; color:white;">PASƒ∞F</span>':"",r=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" style="top:0; right:0; font-size:0.9rem; padding:4px;" onclick="event.stopPropagation(); editNews(${a})"></i>`:"";e.innerHTML+=`<div class="news-item" style="${o}">${r}<span class="news-date">${t.date}</span><span class="news-title">${t.title} ${i}</span><div class="news-desc">${t.desc}</div><span class="news-tag ${n}">${l}</span></div>`})}function openGuide(){document.getElementById("guide-modal").style.display="flex";const e=document.getElementById("guide-grid");e.innerHTML="",sportsData.forEach((t,a)=>{let n=t.pronunciation?`<div class="pronunciation-badge"> üó£Ô∏è  ${t.pronunciation}</div>`:"",l=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" style="top:5px; right:5px; z-index:50;" onclick="event.stopPropagation(); editSport('${escapeForJsString(t.title)}')"></i>`:"";e.innerHTML+=`<div class="guide-item" onclick="showSportDetail(${a})">${l}<i class="fas ${t.icon} guide-icon"></i><span class="guide-title">${t.title}</span>${n}<div class="guide-desc">${t.desc}</div><div class="guide-tip"><i class="fas fa-lightbulb"></i> ${t.tip}</div><div style="font-size:0.8rem; color:#999; margin-top:5px;">(Detay i√ßin tƒ±kla)</div></div>`})}function showSportDetail(e){const t=sportsData[e],a=t.detail?t.detail.replace(/\n/g,"<br>"):"Bu i√ßerik i√ßin hen√ºz detay eklenmemi≈ü.",n=t.pronunciation?`<div style="color:#e65100; font-weight:bold; margin-bottom:15px;"> üó£Ô∏è  Okunu≈üu: ${t.pronunciation}</div>`:"";Swal.fire({title:`<i class="fas ${t.icon}" style="color:#0e1b42;"></i> ${t.title}`,html:`${n}<div style="text-align:left; font-size:1rem; line-height:1.6;">${a}</div>`,showCloseButton:!0,showConfirmButton:!1,width:"600px",background:"#f8f9fa"})}function openSales(){document.getElementById("sales-modal").style.display="flex";const e=document.getElementById("sales-grid");e.innerHTML="",salesScripts.forEach((t,a)=>{let n=isAdminMode&&isEditingActive?`<i class="fas fa-pencil-alt edit-icon" style="top:10px; right:40px; z-index:50;" onclick="event.stopPropagation(); editSales('${escapeForJsString(t.title)}')"></i>`:"";e.innerHTML+=`<div class="sales-item" id="sales-${a}" onclick="toggleSales('${a}')">${n}<div class="sales-header"><span class="sales-title">${t.title}</span><i class="fas fa-chevron-down" id="icon-${a}" style="color:#10b981;"></i></div><div class="sales-text">${(t.text||"").replace(/\n/g,"<br>")}<div style="text-align:right; margin-top:15px;"><button class="btn btn-copy" onclick="event.stopPropagation(); copyText('${escapeForJsString(t.text||"")}')"><i class="fas fa-copy"></i> Kopyala</button></div></div></div>`})}function toggleSales(e){const t=document.getElementById(`sales-${e}`),a=document.getElementById(`icon-${e}`);t.classList.toggle("active"),t.classList.contains("active")?a.classList.replace("fa-chevron-down","fa-chevron-up"):a.classList.replace("fa-chevron-up","fa-chevron-down")}function populateMonthFilter(){const e=document.getElementById("month-select-filter");if(!e)return;e.innerHTML="";const t=new Date,a=t.getMonth(),n=t.getFullYear();for(let t=0;t<6;t++){let l=(a-t+12)%12,o=n;a-t<0&&(o=n-1);const i=(l+1).toString().padStart(2,"0"),r=o.toString(),s=`${i}.${r}`,c=`${MONTH_NAMES[l]} ${r}`,d=document.createElement("option");d.value=s,d.textContent=c,0===t&&(d.selected=!0),e.appendChild(d)}}function openQualityArea(){document.getElementById("quality-modal").style.display="flex",document.getElementById("admin-quality-controls").style.display=isAdminMode?"block":"none",populateMonthFilter();const e=document.getElementById("dash-avg-score"),t=document.getElementById("dash-eval-count"),a=document.getElementById("dash-target-rate");e&&(e.innerText="-"),t&&(t.innerText="-"),a&&(a.innerText="-%");const n=document.getElementById("month-select-filter");if(n){const e=n.cloneNode(!0);n.parentNode.replaceChild(e,n),e.addEventListener("change",function(){fetchEvaluationsForAgent()})}isAdminMode?fetchUserListForAdmin().then(e=>{const t=document.getElementById("group-select-admin"),a=document.getElementById("agent-select-admin");t&&a&&(t.innerHTML='<option value="all">T√ºm Gruplar</option>'+[...new Set(e.map(e=>e.group))].sort().map(e=>`<option value="${e}">${e}</option>`).join(""),updateAgentListBasedOnGroup())}):fetchEvaluationsForAgent(currentUser)}function updateAgentListBasedOnGroup(){const e=document.getElementById("group-select-admin"),t=document.getElementById("agent-select-admin");if(!e||!t)return;const a=e.value;t.innerHTML="";let n=adminUserList;"all"!==a?(n=adminUserList.filter(e=>e.group===a),t.innerHTML=`<option value="all">-- T√ºm ${a} Ekibi --</option>`):t.innerHTML='<option value="all">-- T√ºm Temsilciler --</option>',n.forEach(e=>{t.innerHTML+=`<option value="${e.name}">${e.name}</option>`}),fetchEvaluationsForAgent()}async function fetchEvaluationsForAgent(e){const t=document.getElementById("evaluations-list"),a=document.getElementById("quality-loader"),n=document.getElementById("dash-avg-score"),l=document.getElementById("dash-eval-count"),o=document.getElementById("dash-target-rate");t.innerHTML="",a.style.display="block";const i=document.getElementById("group-select-admin"),r=document.getElementById("agent-select-admin");let s=e||currentUser,c="all";if(isAdminMode&&(s=e||(r?r.value:currentUser),c=i?i.value:"all","all"===s&&"all"===c))return a.innerHTML='<div style="padding:20px; text-align:center; color:#1976d2;"><i class="fas fa-users fa-2x"></i><br><br><b>T√ºm ≈ûirket Verisi</b><br>Detaylƒ± analiz i√ßin yukarƒ±daki "Rapor" butonunu kullanƒ±n.</div>',n&&(n.innerText="-"),l&&(l.innerText="-"),void(o&&(o.innerText="-%"));if(!s)return void(a.innerHTML='<span style="color:red;">L√ºtfen listeden bir temsilci se√ßimi yapƒ±n.</span>');const d=document.getElementById("month-select-filter").value;try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"fetchEvaluations",targetAgent:s,targetGroup:c,username:currentUser,token:getToken()})}),i=await e.json();if(a.style.display="none","success"===i.result){allEvaluationsData=i.evaluations;let e=allEvaluationsData.filter(e=>{return e.date.substring(3)===d});const r=e.reduce((e,t)=>e+(parseFloat(t.score)||0),0),u=e.length,p=u>0?r/u:0,m=e.filter(e=>(parseFloat(e.score)||0)>=90).length,g=u>0?Math.round(m/u*100):0;if(n&&(n.innerText=p%1==0?p:p.toFixed(1)),l&&(l.innerText=u),o&&(o.innerText=`%${g}`),0===e.length)return void(t.innerHTML='<p style="text-align:center; color:#666; margin-top:20px;">Bu d√∂nem i√ßin kayƒ±t yok.</p>');let y="";e.reverse().forEach((e,t)=>{const a=e.score>=90?"#2e7d32":e.score>=70?"#ed6c02":"#d32f2f",n=formatDateToDDMMYYYY(e.callDate),l=formatDateToDDMMYYYY(e.date);let o="";try{const e=JSON.parse(e.details);o='<table style="width:100%; font-size:0.85rem; border-collapse:collapse; margin-top:10px;">',e.forEach(e=>{let t=e.score<e.max?"#ffebee":"#f9f9f9",a=e.note?`<br><em style="color: #d32f2f; font-size:0.8rem;">(Not: ${e.note})</em>`:"";o+=`<tr style="background:${t}; border-bottom:1px solid #fff;">\n                            <td style="padding:8px; border-radius:4px;">${e.q}${a}</td>\n                            <td style="padding:8px; font-weight:bold; text-align:right;">${e.score}/${e.max}</td>\n                        </tr>`}),o+="</table>"}catch(e){o=`<p style="white-space:pre-wrap; margin:0; font-size:0.9rem;">${e.details}</p>`}let i=isAdminMode?`<i class="fas fa-pen" style="font-size:1rem; color:#fabb00; cursor:pointer; margin-right:5px; padding:5px;" onclick="event.stopPropagation(); editEvaluation('${e.callId}')" title="Kaydƒ± D√ºzenle"></i>`:"",r="all"===s?`<span style="font-size:0.8rem; font-weight:bold; color:#555; background:#eee; padding:2px 6px; border-radius:4px; margin-left:10px;">${e.agent}</span>`:"";y+=`<div class="evaluation-summary" id="eval-summary-${t}" style="position:relative; border:1px solid #eaedf2; border-left:4px solid ${a}; padding:15px; margin-bottom:10px; border-radius:8px; background:#fff; cursor:pointer; transition:all 0.2s ease;" onclick="toggleEvaluationDetail(${t})">\n                    \n                    <div style="display:flex; justify-content:space-between; align-items:center;">\n                        \n                        <!-- SOL TARAFI (TARƒ∞HLER VE ID) -->\n                        <div style="display:flex; flex-direction:column; gap:4px;">\n                            <!-- √úST: √áAƒûRI TARƒ∞Hƒ∞ + (Opsiyonel Ajan Adƒ±) -->\n                            <div style="display:flex; align-items:center; gap:8px;">\n                                <i class="fas fa-phone-alt" style="color:#b0b8c1; font-size:0.9rem;"></i>\n                                <span style="font-weight:700; color:#2c3e50; font-size:1.05rem;">${n}</span>\n                                ${r}\n                            </div>\n                            \n                            <!-- ALT: LOG TARƒ∞Hƒ∞ VE ID -->\n                            <div style="font-size:0.75rem; color:#94a3b8; margin-left:22px;">\n                                <span style="font-weight:500;">Log:</span> ${l} \n                                <span style="margin:0 4px; color:#cbd5e0;">|</span> \n                                <span style="font-weight:500;">ID:</span> ${e.callId||"-"}\n                            </div>\n                        </div>\n                        <!-- SAƒû TARAFI (PUAN VE EDƒ∞T ƒ∞KONU) -->\n                        <div style="text-align:right; display:flex; flex-direction:column; align-items:flex-end;">\n                            <div style="display:flex; align-items:center;">\n                                ${i} \n                                <span style="font-weight:800; font-size:1.6rem; color:${a}; line-height:1;">${e.score}</span>\n                            </div>\n                            <span style="font-size:0.65rem; color:#a0aec0; letter-spacing:0.5px; font-weight:600;">PUAN</span>\n                        </div>\n                    </div>\n                    <div class="evaluation-details-content" id="eval-details-${t}">\n                        <hr style="border:none; border-top:1px dashed #eee; margin:12px 0;">\n                        ${o}\n                        <div style="margin-top:10px; background:#f8f9fa; padding:10px; border-radius:6px; border-left:3px solid #e2e8f0;">\n                             <strong style="color:#4a5568; font-size:0.8rem;">Geri Bildirim:</strong>\n                             <p style="color:#2d3748; font-size:0.9rem; margin:5px 0 0 0;">${e.feedback||"Geri bildirim girilmedi."}</p>\n                        </div>\n                    </div>\n                </div>`}),t.innerHTML=y}else t.innerHTML=`<p style="color:red; text-align:center;">Veri √ßekme hatasƒ±: ${i.message||"Bilinmeyen Hata"}</p>`}catch(e){a.style.display="none",t.innerHTML='<p style="color:red; text-align:center;">Baƒülantƒ± hatasƒ±.</p>'}}async function exportEvaluations(){if(!isAdminMode)return void Swal.fire("Hata","Bu i≈ülem i√ßin y√∂netici yetkisi gereklidir.","error");const e=document.getElementById("agent-select-admin"),t=document.getElementById("group-select-admin"),a=e?e.value:"all",n=t?t.value:"all",l="all"===a?"all"===n?"T√ºm ≈ûirket":n+" Ekibi":a,{isConfirmed:o}=await Swal.fire({icon:"question",title:"Raporu Onayla",html:`<strong>${l}</strong> i√ßin t√ºm deƒüerlendirme kayƒ±tlarƒ± (kƒ±rƒ±lƒ±m detaylarƒ± dahil) CSV formatƒ±nda indirilecektir. Onaylƒ±yor musunuz?`,showCancelButton:!0,confirmButtonText:'<i class="fas fa-download"></i> ƒ∞ndir',cancelButtonText:"ƒ∞ptal"});if(o){Swal.fire({title:"Kƒ±rƒ±lƒ±m Raporu Hazƒ±rlanƒ±yor...",didOpen:()=>Swal.showLoading()});try{const e=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"exportEvaluations",targetAgent:a,targetGroup:n,username:currentUser,token:getToken()})}),t=await e.json();if("success"===t.result&&t.csvData){const e=new Blob(["\ufeff"+t.csvData],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");void 0!==a.download?(a.setAttribute("href",URL.createObjectURL(e)),a.setAttribute("download",t.fileName),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),Swal.fire("Ba≈üarƒ±lƒ±",`Rapor <strong>${t.fileName}</strong> adƒ±yla indirildi.`,"success")):Swal.fire("Hata","Tarayƒ±cƒ±nƒ±z otomatik indirmeyi desteklemiyor.","error")}else Swal.fire("Hata",t.message||"Rapor verisi alƒ±namadƒ±.","error")}catch(e){console.error("Export Error:",e),Swal.fire("Hata","Sunucuya baƒülanƒ±lamadƒ±.","error")}}}function fetchUserListForAdmin(){return new Promise(e=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getUserList",username:currentUser,token:getToken()})}).then(e=>e.json()).then(t=>{"success"===t.result?adminUserList=t.users.filter(e=>"Y√∂netim"!==e.group):adminUserList=[],e(adminUserList)}).catch(t=>e([]))})}function fetchCriteria(e){return new Promise(t=>{fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getCriteria",group:e,username:currentUser,token:getToken()})}).then(e=>e.json()).then(e=>{"success"===e.result?t(e.criteria||[]):t([])}).catch(e=>{console.error(e),t([])})})}function toggleEvaluationDetail(e){const t=document.getElementById(`eval-details-${e}`),a=(document.getElementById(`eval-icon-${e}`),"0px"!==t.style.maxHeight&&""!==t.style.maxHeight);a?(t.style.maxHeight="0px",t.style.marginTop="0"):(t.style.maxHeight=t.scrollHeight+100+"px",t.style.marginTop="10px")}async function logEvaluationPopup(){const e=document.getElementById("agent-select-admin"),t=e?e.value:"";if(!t||"all"===t)return void Swal.fire("Uyarƒ±","L√ºtfen i≈ülem yapmak i√ßin listeden bir personel se√ßiniz.","warning");let a="Genel";const n=adminUserList.find(e=>e.name.toLowerCase()===t.toLowerCase());if(n&&n.group&&(a=n.group),"Chat"===a){const{value:e}=await Swal.fire({title:"Chat Form Tipi Se√ßin",text:`${t} i√ßin hangi Chat formunu kullanacaksƒ±nƒ±z?`,input:"radio",inputOptions:{"Chat-Normal":"Chat - Normal ƒ∞≈ülem","Chat-Teknik":"Chat - Teknik Destek"},inputValidator:e=>{if(!e)return"Bir form tipi se√ßmelisiniz!"},showCancelButton:!0,confirmButtonText:"Devam Et",cancelButtonText:"ƒ∞ptal",focusConfirm:!1});if(!e)return;a=e}Swal.fire({title:"Deƒüerlendirme Formu Hazƒ±rlanƒ±yor...",didOpen:()=>Swal.showLoading()});let l=[];a&&"Genel"!==a&&(l=await fetchCriteria(a)),Swal.close();const o=(new Date).toISOString().substring(0,10),i=l.length>0;let r="",s="";i?(r+='<div class="criteria-container">',l.forEach((e,t)=>{let a=parseInt(e.points)||0;r+=`\n                <div class="criteria-row" id="row-${t}">\n                    <div class="criteria-header">\n                        <span>${t+1}. ${e.text}</span>\n                        <span style="font-size:0.8rem; color:#999;">Max: ${a}</span>\n                    </div>\n                    <div class="criteria-controls">\n                        <input type="range" class="custom-range slider-input" id="slider-${t}" min="0" max="${a}" value="${a}" data-index="${t}" oninput="updateRowScore(${t}, ${a})">\n                        <span class="score-badge" id="badge-${t}">${a}</span>\n                    </div>\n                    <input type="text" id="note-${t}" class="note-input" placeholder="Kƒ±rƒ±lƒ±m nedeni veya not ekle..." style="display:none;">\n                </div>`}),r+="</div>"):s=`\n            <div style="padding:15px; border:1px dashed #ccc; background:#fff; border-radius:8px; text-align:center; margin-bottom:15px;">\n                <p style="color:#e65100;">(Bu grup i√ßin otomatik kriter bulunamadƒ±)</p>\n                <label style="font-weight:bold;">Manuel Puan</label><br>\n                <input id="eval-manual-score" type="number" class="swal2-input" value="100" min="0" max="100" style="width:100px; text-align:center; font-size:1.5rem; font-weight:bold;">\n            </div>\n            <textarea id="eval-details" class="swal2-textarea" placeholder="Deƒüerlendirme detaylarƒ±..." style="margin-bottom:15px;"></textarea>\n        `;const c=`\n        <div class="eval-modal-wrapper">\n            <div class="score-dashboard">\n                <div>\n                    <div style="font-size:0.9rem; opacity:0.8;">Deƒüerlendirilen</div>\n                    <div style="font-size:1.2rem; font-weight:bold; color:#fabb00;">${t}</div>\n                    <div style="font-size:0.8rem; opacity:0.7;">${a}</div>\n                </div>\n                <div class="score-circle-outer" id="score-ring">\n                    <div class="score-circle-inner" id="live-score">${i?"100":"100"}</div>\n                </div>\n            </div>\n            <div class="eval-header-card">\n                <div>\n                    <label style="font-size:0.8rem; font-weight:bold; color:#555;">Call ID</label>\n                    <input id="eval-callid" class="swal2-input" style="height:35px; margin:0; width:100%; font-size:0.9rem;" placeholder="Call ID giriniz">\n                </div>\n                <div>\n                    <label style="font-size:0.8rem; font-weight:bold; color:#555;">√áaƒürƒ±/Chat Tarihi</label>\n                    <input type="date" id="eval-calldate" class="swal2-input" style="height:35px; margin:0; width:100%; font-size:0.9rem;" value="${o}">\n                </div>\n            </div>\n            ${s}\n            ${r}\n            <div style="margin-top:15px; border:1px solid #f0f0f0; background:#fafafa; padding:10px; border-radius:8px;">\n                <label style="font-size:0.85rem; font-weight:bold; color:#333; display:block; margin-bottom:5px;">Geri Bildirim Tipi (Raporlama ƒ∞√ßin)</label>\n                <select id="feedback-type" class="swal2-input" style="width:100%; height:40px; border:1px solid #ccc; border-radius:5px; margin:0;">\n                    <option value="Yok">Geri Bildirim Yok</option>\n                    <option value="S√∂zl√º">S√∂zl√º (Verbal)</option>\n                    <option value="Mail">Mail (E-posta)</option>\n                </select>\n            </div>\n            <div style="margin-top:15px;">\n                <label style="font-size:0.85rem; font-weight:bold; color:#333;">Genel Geri Bildirim</label>\n                <textarea id="eval-feedback" class="swal2-textarea" style="margin-top:5px; height:80px;" placeholder="Temsilciye iletilecek genel yorum..."></textarea>\n            </div>\n        </div>`,{value:d}=await Swal.fire({title:"",html:c,width:"600px",padding:"0 0 20px 0",showCancelButton:!0,confirmButtonText:" üíæ  Kaydet",cancelButtonText:"ƒ∞ptal",focusConfirm:!1,didOpen:()=>{i&&window.recalcTotalScore()},preConfirm:()=>{const e=document.getElementById("eval-callid").value,n=document.getElementById("eval-calldate").value,o=document.getElementById("eval-feedback").value,r=document.getElementById("feedback-type").value;if(!e||!n||!o)return Swal.showValidationMessage("L√ºtfen √áaƒürƒ± ID, Tarih ve Genel Geri Bildirim alanlarƒ±nƒ± doldurun."),!1;const s=n.split("-"),c=3===s.length?`${s[2]}.${s[1]}.${s[0]}`:n;if(i){let n=0,i=[];return l.forEach((e,t)=>{let a=parseInt(document.getElementById(`slider-${t}`).value)||0,l=parseInt(e.points)||0,o=document.getElementById(`note-${t}`).value;n+=a,i.push({q:e.text,max:l,score:a,note:o})}),{agentName:t,agentGroup:a,callId:e,callDate:c,score:n,details:JSON.stringify(i),feedback:o,feedbackType:r}}else{const n=document.getElementById("eval-manual-score").value,l=document.getElementById("eval-details").value;return n<0||n>100?(Swal.showValidationMessage("Puan 0 ile 100 arasƒ±nda olmalƒ±dƒ±r."),!1):{agentName:t,agentGroup:a,callId:e,callDate:c,score:parseInt(n),details:l,feedback:o,feedbackType:r}}}});d&&(Swal.fire({title:"Kaydediliyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logEvaluation",username:currentUser,token:getToken(),...d})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"Deƒüerlendirme Kaydedildi",text:`${d.agentName} i√ßin ${d.score} puan verildi.`,timer:2500,showConfirmButton:!1}),fetchEvaluationsForAgent(d.agentName)):Swal.fire("Hata",e.message||"Kaydedilemedi.","error")}).catch(e=>{Swal.fire("Hata","Sunucu hatasƒ±.","error")}))}async function editEvaluation(e){const t=allEvaluationsData.find(t=>String(t.callId).trim()===String(e).trim());if(!t)return void Swal.fire("Hata","Kayƒ±t verisi bulunamadƒ±.","error");const a=t.agent||t.agentName,n=t.group||"Genel";Swal.fire({title:"Kayƒ±tlar ƒ∞nceleniyor...",didOpen:()=>Swal.showLoading()});let l=[];n&&"Genel"!==n&&(l=await fetchCriteria(n)),Swal.close();const o=l.length>0;let i=[];try{i=JSON.parse(t.details||"[]")}catch(e){i=[]}let r=`\n    <div class="eval-modal-wrapper" style="border-top: 5px solid #1976d2;">\n    <div class="score-dashboard">\n    <div>\n    <div style="font-size:0.9rem; opacity:0.8;">D√úZENLENEN</div>\n    <div style="font-size:1.2rem; font-weight:bold; color:#1976d2;">${a}</div>\n    <div style="font-size:0.8rem; opacity:0.7;">(ƒ∞tiraz / D√ºzeltme)</div>\n    </div>\n    <div class="score-circle-outer" id="score-ring">\n    <div class="score-circle-inner" id="live-score">0</div>\n    </div>\n    </div>\n    <div class="eval-header-card">\n    <div>\n    <label style="font-size:0.8rem; font-weight:bold; color:#555;">Call ID</label>\n    <input id="eval-callid" class="swal2-input" style="height:35px; margin:0; width:100%; font-size:0.9rem; background:#eee;" value="${t.callId}" readonly>\n    </div>\n    <div>\n    <label style="font-size:0.8rem; font-weight:bold; color:#555;">√áaƒürƒ± Tarihi</label>\n    <input type="text" class="swal2-input" style="height:35px; margin:0; width:100%; font-size:0.9rem; background:#eee;" value="${t.callDate}" readonly>\n    </div>\n    </div>\n    `;o?(r+='<div class="criteria-container">',l.forEach((e,t)=>{let a=parseInt(e.points)||0;r+=`\n            <div class="criteria-row" id="row-${t}">\n            <div class="criteria-header">\n            <span>${t+1}. ${e.text}</span>\n            <span style="font-size:0.8rem; color:#999;">Max: ${a}</span>\n            </div>\n            <div class="criteria-controls">\n            <input type="range" class="custom-range slider-input" id="slider-${t}" min="0" max="${a}" data-index="${t}" oninput="updateRowScore(${t}, ${a})">\n            <span class="score-badge" id="badge-${t}">0</span>\n            </div>\n            <input type="text" id="note-${t}" class="note-input" placeholder="Kƒ±rƒ±lƒ±m nedeni..." style="display:none;">\n            </div>`}),r+="</div>"):r+=`\n        <div style="padding:15px; border:1px dashed #ccc; background:#fff; border-radius:8px; text-align:center;">\n        <label style="font-weight:bold;">Manuel Puan</label><br>\n        <input id="eval-manual-score" type="number" class="swal2-input" value="${t.score}" min="0" max="100" style="width:100px; text-align:center; font-size:1.5rem; font-weight:bold;">\n        </div>\n        <textarea id="eval-details" class="swal2-textarea" placeholder="Detaylar..."></textarea>\n        `,r+=`\n    <div>\n    <label style="font-size:0.85rem; font-weight:bold; color:#333;">Revize Geri Bildirim</label>\n    <textarea id="eval-feedback" class="swal2-textarea" style="margin-top:5px; height:80px;"></textarea>\n    </div>\n    </div>`;const{value:s}=await Swal.fire({html:r,width:"600px",showCancelButton:!0,confirmButtonText:" üíæ  G√ºncelle",cancelButtonText:"ƒ∞ptal",focusConfirm:!1,didOpen:()=>{if(document.getElementById("eval-feedback").value=t.feedback||"",!o){const e=document.getElementById("eval-details");e&&(e.value="string"==typeof t.details?t.details:"")}o&&(l.forEach((e,a)=>{let n=parseInt(e.points),l=i.find(t=>t.q===e.text);!l&&i[a]&&(l=i[a]),l||(l={score:n,note:""});let r=parseInt(l.score),s=l.note||"",c=document.getElementById(`slider-${a}`),d=document.getElementById(`note-${a}`);c&&(c.value=r,window.updateRowScore(a,n)),d&&(d.value=s,r<n&&(d.style.display="block"))}),window.recalcTotalScore())},preConfirm:()=>{const e=document.getElementById("eval-callid").value,n=document.getElementById("eval-feedback").value;if(o){let t=0,o=[];return l.forEach((e,a)=>{let n=parseInt(document.getElementById(`slider-${a}`).value)||0,l=parseInt(e.points)||0,i=document.getElementById(`note-${a}`).value;t+=n,o.push({q:e.text,max:l,score:n,note:i})}),{agentName:a,callId:e,score:t,details:JSON.stringify(o),feedback:n}}else{const t=document.getElementById("eval-manual-score").value,l=document.getElementById("eval-details").value;return{agentName:a,callId:e,score:parseInt(t),details:l,feedback:n}}}});s&&(Swal.fire({title:"G√ºncelleniyor...",didOpen:()=>{Swal.showLoading()}}),fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"updateEvaluation",username:currentUser,token:getToken(),...s})}).then(e=>e.json()).then(e=>{"success"===e.result?(Swal.fire({icon:"success",title:"G√ºncellendi",text:"Puan ve detaylar revize edildi.",timer:1500,showConfirmButton:!1}),fetchEvaluationsForAgent(a)):Swal.fire("Hata",e.message||"G√ºncellenemedi.","error")}).catch(e=>{Swal.fire("Hata","Sunucu hatasƒ±.","error")}))}function updateJokerButtons(){document.getElementById("joker-call").disabled=0===jokers.call,document.getElementById("joker-half").disabled=0===jokers.half,document.getElementById("joker-double").disabled=0===jokers.double||-1!==firstAnswerIndex,-1!==firstAnswerIndex&&(document.getElementById("joker-call").disabled=!0,document.getElementById("joker-half").disabled=!0,document.getElementById("joker-double").disabled=!0)}function useJoker(e){if(0===jokers[e]||-1!==firstAnswerIndex&&"double"!==e)return;jokers[e]=0,updateJokerButtons();const t=pCurrentQ,a=t.a,n=document.querySelectorAll(".penalty-btn");if("call"===e){const e=["Umut Bey","Doƒüu≈ü Bey","Deniz Bey","Esra Hanƒ±m"][Math.floor(4*Math.random())];let n=a;Math.random()>.8&&t.opts.length>1&&(n=t.opts.map((e,t)=>t).filter(e=>e!==a)[Math.floor(Math.random()*(t.opts.length-1))]||a),Swal.fire({icon:"info",title:" üìû  Telefon Jokeri",html:`${e} soruyu cevaplƒ±yor...<br><br>"Benim tahminim kesinlikle **${String.fromCharCode(65+n)}** ≈üƒ±kkƒ±. Bundan ${Math.random()<.8?"√ßok eminim":"emin deƒüilim"}."`,confirmButtonText:"Kapat"})}else"half"===e?(t.opts.map((e,t)=>t).filter(e=>e!==a).sort(()=>Math.random()-.5).slice(0,2).forEach(e=>{n[e].disabled=!0,n[e].style.textDecoration="line-through",n[e].style.opacity="0.4"}),Swal.fire({icon:"success",title:" ‚úÇÔ∏è  Yarƒ± Yarƒ±ya Kullanƒ±ldƒ±",text:"ƒ∞ki yanlƒ±≈ü ≈üƒ±k elendi!",toast:!0,position:"top",showConfirmButton:!1,timer:1500})):"double"===e&&(doubleChanceUsed=!0,Swal.fire({icon:"warning",title:"2Ô∏è ‚É£  √áift Cevap",text:"Bu soruda bir kez yanlƒ±≈ü cevap verme hakkƒ±nƒ±z var. ƒ∞lk cevabƒ±nƒ±z yanlƒ±≈üsa, ikinci kez deneyebilirsiniz.",toast:!0,position:"top",showConfirmButton:!1,timer:2500}))}function openPenaltyGame(){document.getElementById("penalty-modal").style.display="flex",showLobby()}function showLobby(){document.getElementById("penalty-lobby").style.display="flex",document.getElementById("penalty-game-area").style.display="none",fetchLeaderboard()}function startGameFromLobby(){document.getElementById("penalty-lobby").style.display="none",document.getElementById("penalty-game-area").style.display="block",startPenaltySession()}function fetchLeaderboard(){const e=document.getElementById("leaderboard-body"),t=document.getElementById("leaderboard-loader"),a=document.getElementById("leaderboard-table");e.innerHTML="",t.style.display="block",a.style.display="none",fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getLeaderboard"})}).then(e=>e.json()).then(n=>{if(t.style.display="none","success"===n.result){a.style.display="table";let t="";0===n.leaderboard.length?t='<tr><td colspan="4" style="text-align:center; color:#666;">Hen√ºz ma√ß yapƒ±lmadƒ±.</td></tr>':n.leaderboard.forEach((e,a)=>{let n=0===a?" ü•á ":1===a?" ü•à ":2===a?" ü•â ":`<span class="rank-badge">${a+1}</span>`,l=e.username===currentUser?"background:rgba(250, 187, 0, 0.1);":"";t+=`<tr style="${l}"><td>${n}</td><td style="text-align:left;">${e.username}</td><td>${e.games}</td><td>${e.average}</td></tr>`}),e.innerHTML=t}else t.innerText="Y√ºklenemedi.",t.style.display="block"}).catch(e=>{console.error(e),t.innerText="Baƒülantƒ± hatasƒ±."})}function startPenaltySession(){pScore=0,pBalls=10,jokers={call:1,half:1,double:1},doubleChanceUsed=!1,firstAnswerIndex=-1,updateJokerButtons(),document.getElementById("p-score").innerText=pScore,document.getElementById("p-balls").innerText=pBalls,document.getElementById("p-restart-btn").style.display="none",document.getElementById("p-options").style.display="grid",resetField(),loadPenaltyQuestion()}function loadPenaltyQuestion(){if(pBalls<=0)return void finishPenaltyGame();if(0===quizQuestions.length)return void Swal.fire("Hata","Soru yok!","warning");pCurrentQ=quizQuestions[Math.floor(Math.random()*quizQuestions.length)],document.getElementById("p-question-text").innerText=pCurrentQ.q,doubleChanceUsed=!1,firstAnswerIndex=-1,updateJokerButtons();let e="";pCurrentQ.opts.forEach((t,a)=>{const n=String.fromCharCode(65+a);e+=`<button class="penalty-btn" onclick="shootBall(${a})">${n}: ${t}</button>`}),document.getElementById("p-options").innerHTML=e}function shootBall(e){const t=document.querySelectorAll(".penalty-btn"),a=e===pCurrentQ.a;if(!a&&doubleChanceUsed&&-1===firstAnswerIndex)return firstAnswerIndex=e,t[e].classList.add("wrong-first-try"),t[e].disabled=!0,Swal.fire({toast:!0,position:"top",icon:"info",title:"ƒ∞lk Hata! Kalan Hakkƒ±nƒ±z: 1",showConfirmButton:!1,timer:1500,background:"#ffc107"}),void updateJokerButtons();t.forEach(e=>e.disabled=!0);const n=document.getElementById("ball-wrap"),l=document.getElementById("keeper-wrap"),o=document.getElementById("shooter-wrap"),i=document.getElementById("goal-msg"),r=Math.floor(4*Math.random());o.classList.add("shooter-run"),setTimeout(()=>{a?0===r||2===r?l.classList.add("keeper-dive-right"):l.classList.add("keeper-dive-left"):0===r||2===r?l.classList.add("keeper-dive-left"):l.classList.add("keeper-dive-right"),a?(0===r?n.classList.add("ball-shoot-left-top"):1===r?n.classList.add("ball-shoot-right-top"):2===r?n.classList.add("ball-shoot-left-low"):n.classList.add("ball-shoot-right-low"),setTimeout(()=>{i.innerText="GOL!!!",i.style.color="#fabb00",i.classList.add("show"),pScore++,document.getElementById("p-score").innerText=pScore,Swal.fire({toast:!0,position:"top",icon:"success",title:"M√ºkemmel ≈ûut!",showConfirmButton:!1,timer:1e3,background:"#a5d6a7"})},500)):Math.random()>.5?(n.style.bottom="160px",n.style.left=0===r||2===r?"40%":"60%",n.style.transform="scale(0.6)",setTimeout(()=>{i.innerText="KURTARDI!",i.style.color="#ef5350",i.classList.add("show"),Swal.fire({icon:"error",title:"Ka√ßƒ±rdƒ±n!",text:`Doƒüru cevap: ${String.fromCharCode(65+pCurrentQ.a)}. ${pCurrentQ.opts[pCurrentQ.a]}`,showConfirmButton:!0,timer:2500,background:"#ef9a9a"})},500)):(n.classList.add(Math.random()>.5?"ball-miss-left":"ball-miss-right"),setTimeout(()=>{i.innerText="DI≈ûARI!",i.style.color="#ef5350",i.classList.add("show"),Swal.fire({icon:"error",title:"Ka√ßƒ±rdƒ±n!",text:`Doƒüru cevap: ${String.fromCharCode(65+pCurrentQ.a)}. ${pCurrentQ.opts[pCurrentQ.a]}`,showConfirmButton:!0,timer:2500,background:"#ef9a9a"})},500))},300),pBalls--,document.getElementById("p-balls").innerText=pBalls,setTimeout(()=>{resetField(),loadPenaltyQuestion()},2500)}function resetField(){const e=document.getElementById("ball-wrap"),t=document.getElementById("keeper-wrap"),a=document.getElementById("shooter-wrap"),n=document.getElementById("goal-msg");e.className="ball-wrapper",e.style="",t.className="keeper-wrapper",a.className="shooter-wrapper",n.classList.remove("show"),document.querySelectorAll(".penalty-btn").forEach(e=>{e.classList.remove("wrong-first-try"),e.style.textDecoration="",e.style.opacity="",e.style.background="#fabb00",e.style.color="#0e1b42",e.style.borderColor="#f0b500",e.disabled=!1})}function finishPenaltyGame(){let e=pScore>=8?"EFSANE!  üèÜ ":pScore>=5?"ƒ∞yi Ma√ßtƒ±!  üëè ":"Antrenman Lazƒ±m  ü§ï ";document.getElementById("p-question-text").innerHTML=`<span style="font-size:1.5rem; color:#fabb00;">MA√á Bƒ∞TTƒ∞!</span><br>${e}<br>Toplam Skor: ${pScore}/10`,document.getElementById("p-options").style.display="none",document.getElementById("p-restart-btn").style.display="block",fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"logQuiz",username:currentUser,token:getToken(),score:10*pScore,total:100})})}function openWizard(){document.getElementById("wizard-modal").style.display="flex",0===Object.keys(wizardStepsData).length?(Swal.fire({title:"ƒ∞ade Asistanƒ± Verisi Y√ºkleniyor...",didOpen:()=>Swal.showLoading()}),loadWizardData().then(()=>{Swal.close(),wizardStepsData&&wizardStepsData.start?renderStep("start"):document.getElementById("wizard-body").innerHTML='<h2 style="color:red;">Asistan verisi eksik veya hatalƒ±. L√ºtfen y√∂neticinizle ileti≈üime ge√ßin.</h2>'}).catch(()=>{Swal.close(),document.getElementById("wizard-body").innerHTML='<h2 style="color:red;">Sunucudan veri √ßekme hatasƒ± olu≈ütu.</h2>'})):renderStep("start")}function renderStep(e){const t=wizardStepsData[e];if(!t)return void(document.getElementById("wizard-body").innerHTML=`<h2 style="color:red;">HATA: Adƒ±m ID'si (${e}) bulunamadƒ±. L√ºtfen y√∂neticinizle ileti≈üime ge√ßin.</h2>`);const a=document.getElementById("wizard-body");let n=`<h2 style="color:var(--primary);">${t.title||""}</h2>`;if(t.result){let e="red"===t.result?" üõë ":"green"===t.result?" ‚úÖ ":" ‚ö†Ô∏è ",l="red"===t.result?"res-red":"green"===t.result?"res-green":"res-yellow";n+=`<div class="result-box ${l}"><div style="font-size:3rem;margin-bottom:10px;">${e}</div><h3>${t.title}</h3><p>${t.text}</p>${t.script?`<div class="script-box">${t.script}</div>`:""}</div><button class="restart-btn" onclick="renderStep('start')"><i class="fas fa-redo"></i> Ba≈üa D√∂n</button>`}else n+=`<p>${t.text}</p><div class="wizard-options">`,t.options.forEach(e=>{n+=`<button class="option-btn" onclick="renderStep('${e.next}')"><i class="fas fa-chevron-right"></i> ${e.text}</button>`}),n+="</div>","start"!==e&&(n+=`<button class="restart-btn" onclick="renderStep('start')" style="background:#eee;color:#333;margin-top:15px;">Ba≈üa D√∂n</button>`);a.innerHTML=n}
